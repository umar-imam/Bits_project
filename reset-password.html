<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Password Reset</title>

 
  <!-- Font Awesome (you can remove if no icons are used) -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  />
  <!-- Bootstrap Icons (optional) -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
  />
 
  <style>
    body{
      font-family:'Segoe UI',sans-serif;
      background: linear-gradient(to right, #28315b, #124453, #287cea);
      display:flex;
      justify-content:center;
      align-items:center;
      height:100vh;
      margin:0;
    }
    
    .container{
      background:#e3dcdc;
      padding:30px;
      border-radius:10px;
      width:340px;
      box-shadow:0 4px 10px rgba(138, 50, 50, 0.1);
    }
    h2{ text-align:center; margin-bottom:25px; }
    label{ font-weight:500; margin-bottom:5px; display:block; }
    .input-group{ position:relative; margin-bottom:15px; }
    .input-group input[type="password"],
    .input-group input[type="text"]{
      width:100%;
      padding:10px 40px 10px 10px;
      border:1px solid #5361cc;
      border-radius:5px;
      font-size:14px;
      box-sizing:border-box;
    }
    .toggle-password{               /* kept in case you add icons back */
      position:absolute;
      top:50%;
      right:10px;
      transform:translateY(-50%);
      cursor:pointer;
      color:#e21e1e;
      font-size:18px;
      z-index:2;
    }
    .message{
      font-size:.85em;
      color:#d93025;
      margin-top:-10px;
      margin-bottom:10px;
      display:none;
    }
    button{
      width:100%;
      padding:10px;
      background-color:#00bcd4;
      color:white;
      border:none;
      border-radius:5px;
      font-weight:bold;
      font-size:15px;
      cursor:pointer;
    }
    button:hover{ background-color:#0097a7; }
    .login-btn{
      background-color:#4caf50;
      margin-top:10px;
    }
    .login-btn:hover{ background-color:#45a049; }
    #confirmationMessage{
      font-size:1em;
      margin-top:15px;
      text-align:center;
    }

  
  </style>
</head>
 
<body>
  <div class="container">
    <h2>Reset Your Password</h2>
 
    <label>Default Password</label>
    <div class="input-group">
      <input type="password" id="defaultPassword" placeholder="Enter default password" />
    </div>
 
    <label>New Password</label>
    <div class="input-group">
      <input
        type="password"
        id="newPassword"
        placeholder="Enter new password"
        onkeyup="checkStrength()"
      />
    </div>
    <div id="strengthMessage" class="message"></div>
 
    <label>Confirm Password</label>
    <div class="input-group">
      <input
        type="password"
        id="confirmPassword"
        placeholder="Re-enter new password"
        onkeyup="checkMatch()"
      />
    </div>
    <div id="matchMessage" class="message"></div>
 
    <button onclick="resetPassword()">Reset Password</button>
    <div id="confirmationMessage"></div>
    <button
      id="loginBtn"
      class="login-btn"
      style="display:none;"
      onclick="navigateToLogin()"
    >
      Login
    </button>
  </div>
 
  <script>
    /* ---------- 1. Read & parse ?issued= ----------- */
    const params      = new URLSearchParams(window.location.search);
    const issuedParam = params.get("issued");                       // e.g. 10-06-2025
 
    function parseIssuedDate(str){
      if(!str) return new Date();                                   // default = today
 
      // ISO-8601  (YYYY-MM-DD)
      if(/^\d{4}-\d{2}-\d{2}$/.test(str))
        return new Date(str + "T00:00:00");
 
      // European  (DD-MM-YYYY)
      if(/^\d{2}-\d{2}-\d{4}$/.test(str)){
        const [d,m,y] = str.split("-").map(Number);
        return new Date(y, m-1, d);                                 // months 0-based
      }
      // Fallback
      return new Date(str);
    }
 
    const issuedDate = parseIssuedDate(issuedParam);                // Date object
 
    /* ---------- 2. UI helpers ---------- */
    function checkStrength(){
      const pwd = document.getElementById("newPassword").value;
      const msg = document.getElementById("strengthMessage");
      const strongRegex =
        /^(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*])[A-Za-z\d!@#$%^&*]{8,}$/;
 
      if(!pwd){
        msg.style.display = "none";
      }else if(!strongRegex.test(pwd)){
        msg.textContent  = "Use 8+ characters with uppercase, number & symbol.";
        msg.style.display = "block";
      }else{
        msg.style.display = "none";
      }
    }
 
    function checkMatch(){
      const newPwd    = document.getElementById("newPassword").value;
      const confirmPwd= document.getElementById("confirmPassword").value;
      const msg       = document.getElementById("matchMessage");
 
      if(!confirmPwd){
        msg.style.display = "none";
      }else if(newPwd !== confirmPwd){
        msg.textContent  = "Passwords do not match.";
        msg.style.display = "block";
      }else{
        msg.style.display = "none";
      }
    }
 
    /* ---------- 3. Main reset handler (expiry fix applied) ---------- */
    function resetPassword(){
      const defaultPwd = document.getElementById("defaultPassword").value;
      const newPwd     = document.getElementById("newPassword").value;
      const confirmPwd = document.getElementById("confirmPassword").value;
      const msgBox     = document.getElementById("confirmationMessage");
 
      /* (a) Accurate 7-day expiry check */
      const todayOnly  = new Date(new Date().toISOString().split("T")[0]);      // yyyy-mm-dd @ 00:00
      const issuedOnly = new Date(issuedDate.toISOString().split("T")[0]);
      const daysPassed = Math.floor((todayOnly - issuedOnly) / 86_400_000);     // ms per day
 
      if(daysPassed > 7){
        msgBox.textContent = "Password has expired. Please request a new one.";
        msgBox.style.color = "red";
        document.getElementById("loginBtn").style.display = "none";
        return;
      }
 
      /* (b) Field checks */
      if(!defaultPwd || !newPwd || !confirmPwd){
        alert("All fields are required.");
        return;
      }
      if(newPwd !== confirmPwd){
        alert("New passwords do not match.");
        return;
      }
 
      /* (c) Success */
      document.getElementById("defaultPassword").value = "";
      document.getElementById("newPassword").value = "";
      document.getElementById("confirmPassword").value = "";
      document.getElementById("strengthMessage").style.display = "none";
      document.getElementById("matchMessage").style.display = "none";
 
      msgBox.textContent = "Password has been reset successfully!";
      msgBox.style.color = "green";
      document.getElementById("loginBtn").style.display = "block";
 
      /* TODO: hook backend call (fetch / Power Automate) */
    }
 
    function navigateToLogin(){
      window.location.href = "https://umar-imam.github.io/Bits_project/login_page.html";
    }
  </script>
</body>
</html>
 
